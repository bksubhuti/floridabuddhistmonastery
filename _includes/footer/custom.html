<div id="tvi-upcoming" style="margin-top:1.25rem">
  <strong>Upcoming Events</strong>
  <ul id="tvi-upcoming-list" style="margin:0.5rem 0 0 1rem"></ul>
</div>

<script>
document.addEventListener("DOMContentLoaded", async function () {
  const tz = "America/New_York";
  const jsonUrl = "{{ '/assets/events.json' | relative_url }}";

  function localETdate(d) {
    return new Date(d.toLocaleString("en-US", { timeZone: tz }));
  }

  try {
    const res = await fetch(`/assets/events.json?v={{ site.time | date: '%s' }}`, { cache: "no-store" });
    const data = await res.json();
    let events = data.events || [];

    // convert ISO back to JS Date
    events = events.map(e => ({ ...e, startDate: new Date(e.startRaw) }));

    const now = new Date();

    // next 3 FUTURE events only 
    events = events.filter(e => e.startDate >= now);

    // already sorted from ruby so no sort needed now 
    const next = events.slice(0, 3);

    const ul = document.getElementById("tvi-upcoming-list");
    ul.innerHTML = "";

    next.forEach(e => {
      let formatted = localETdate(e.startDate).toLocaleString("en-US", {
        weekday: "short",
        month: "short",
        day: "numeric",
        hour: "numeric",
        minute: "2-digit"
      });
      let li = document.createElement("li");
      li.textContent = `${formatted} â€” ${e.summary}`;
      ul.appendChild(li);
    });

  } catch(err) {
    console.error("TVI footer events error:", err);
  }
});
</script>
